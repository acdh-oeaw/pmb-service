{% extends "base.html" %}
{% load static %}
{% block title %}Map{% endblock %}
{% block scriptHeader %}
{% endblock %}
{% block content %}
<style>
    #map {
        width: 100%;
        height: 700px;
    }
</style>

<div class="container-fluid">
        <h1>Map</h1>
        <div id="map"></div>
    
</div>
<span id="url" class="visually-hidden" aria-hidden="true">{% url 'network:geojson' %}{% querystring %}</span>

<script type="text/javascript">
    const url = document.getElementById("url").textContent;
    console.log("fetching data")
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error("Network response was not ok");
            }
            return response.json();
        })
        .then(data => {
            var map = L.map('map').setView([48.20 , 16.37], 6);
            L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
            }).addTo(map);
            const markers = L.markerClusterGroup();
            const geojsonLayer = L.geoJSON(data, {
                onEachFeature: function (feature, layer) {
                    layer.bindPopup(feature.properties.label);
                },
                pointToLayer: function (feature, latlng) {
                    return L.marker(latlng); // Convert GeoJSON points to Leaflet markers
                }
                });
            geojsonLayer.eachLayer(layer => markers.addLayer(layer));
            map.addLayer(markers);
            map.fitBounds(geojsonLayer.getBounds());
        })
        .catch(error => {
            console.error("Something went wrong:", error);
        });

</script>
{% endblock %}